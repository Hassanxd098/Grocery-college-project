<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment - Checkout</title>
    <link href="https://cdn.replit.com/agent/bootstrap-agent-dark-theme.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/custom.css" rel="stylesheet">
</head>
<body>
    <style>
        .store-name {
    font-size: 33px;
    font-weight: bold;
    text-align: center;
    background-color: #130D38;
    color: white;
    font-family: sans-serif;
}
.logo {
    height: 32px;
    vertical-align: middle;
    margin-bottom: 2px;
}

.r-symbol {
    height: 27px;
    vertical-align: middle;
    margin-bottom: 3px;
}
    </style>
    <div class="store-name">
        <div class="store-name">
            <img src="/images/shafralogo.png" alt="Shafra Logo" class="logo">
            Shaf<span><img src="/images/r-symbol.png" alt="R Symbol" class="r-symbol"></span>a <span id="SUP">SUPER MARKET</span>
        </div>        
    </div>

    <div class="container py-5">
        <div class="row">
            <div class="col-md-8">
                <div class="card shadow-sm mb-4">
                    <div class="card-body">
                        <h3 class="card-title mb-4">Payment Method</h3>
                        <div class="payment-methods">
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="cod" value="cod">
                                <label class="form-check-label" for="cod">
                                    <i class="fas fa-money-bill-wave me-2"></i>Cash on Delivery
                                </label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="upi" value="upi">
                                <label class="form-check-label" for="upi">
                                    <i class="fas fa-mobile-alt me-2"></i>UPI Payment
                                </label>
                            </div>
                            <div class="form-check mb-3">
                                <input class="form-check-input" type="radio" name="paymentMethod" id="card" value="card">
                                <label class="form-check-label" for="card">
                                    <i class="fas fa-credit-card me-2"></i>Credit/Debit Card
                                </label>
                            </div>
                        </div>

                        <!-- Payment Forms -->
                        <div id="codForm" class="payment-form mt-4 d-none">
                            <form id="codPaymentForm">
                                <div class="mb-3">
                                    <label class="form-label">Delivery Address</label>
                                    <textarea class="form-control" required rows="3"></textarea>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label">Mobile Number</label>
                                    <input type="tel" class="form-control" required pattern="[0-9]{10}">
                                </div>
                            </form>
                        </div>

                        <div id="upiForm" class="payment-form mt-4 d-none">
                            <form id="upiPaymentForm">
                                <div class="mb-3">
                                    <label class="form-label">UPI ID</label>
                                    <input type="text" class="form-control" required pattern="[a-zA-Z0-9\.-]{2,256}@[a-zA-Z][a-zA-Z]{2,64}">
                                </div>
                            </form>
                        </div>

                        <div id="cardForm" class="payment-form mt-4 d-none">
                            <form id="cardPaymentForm">
                                <div class="mb-3">
                                    <label class="form-label">Card Number</label>
                                    <input type="text" class="form-control" required pattern="[0-9]{16}">
                                </div>
                                <div class="row">
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">Expiry Date</label>
                                        <input type="text" class="form-control" required placeholder="MM/YY" pattern="(0[1-9]|1[0-2])\/([0-9]{2})">
                                    </div>
                                    <div class="col-md-6 mb-3">
                                        <label class="form-label">CVV</label>
                                        <input type="password" class="form-control" required pattern="[0-9]{3,4}">
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-md-4">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h4 class="card-title mb-4">Order Summary</h4>
                        <div id="order-summary"></div>
                        <div class="border-top pt-3 mt-3">
                            <div class="d-flex justify-content-between mb-2">
                                <span>Subtotal</span>
                                <span id="subtotal">Rs.0</span>
                            </div>
                            <div class="d-flex justify-content-between mb-2">
                                <span>Shipping</span>
                                <span id="shipping">Rs.50</span>
                            </div>
                            <div class="d-flex justify-content-between h5">
                                <span>Total</span>
                                <span id="final-total">Rs.0</span>
                            </div>
                        </div>
                        <button onclick="processPayment()" class="btn btn-primary w-100 mt-4">
                            <i class="fas fa-lock me-2"></i>Pay Now
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/payment.js"></script>
</body>
</html>


<script>

document.addEventListener("DOMContentLoaded", function() {
    loadOrderSummary();
    setupPaymentMethodListeners();
});

function loadOrderSummary() {
    const cart = JSON.parse(localStorage.getItem("cart")) || [];
    const summaryDiv = document.getElementById("order-summary");
    let subtotal = 0;

    summaryDiv.innerHTML = cart.map(item => {
        const itemTotal = item.price * item.quantity;
        subtotal += itemTotal;
        return `
            <div class="d-flex justify-content-between mb-2">
                <span>${item.name} x ${item.quantity}</span>
                <span>Rs.${itemTotal}</span>
            </div>
        `;
    }).join("");

    // Calculate shipping based on subtotal
    const shippingCharge = subtotal > 399 ? 0 : 50;

    document.getElementById("subtotal").innerText = `Rs.${subtotal}`;
    document.getElementById("shipping").innerText = `Rs.${shippingCharge}`;
    document.getElementById("final-total").innerText = `Rs.${subtotal + shippingCharge}`;
    // Add a message about free shipping
    if (subtotal <= 399) {
        summaryDiv.innerHTML += `
            <div class="alert alert-info mt-3 mb-2">
                <small>Add items worth Rs.${399 - subtotal} more for free shipping!</small>`
            }
}

function setupPaymentMethodListeners() {
    const paymentMethods = document.querySelectorAll('input[name="paymentMethod"]');
    const paymentForms = document.querySelectorAll('.payment-form');

    paymentMethods.forEach(method => {
        method.addEventListener('change', function() {
            paymentForms.forEach(form => form.classList.add('d-none'));
            document.getElementById(`${this.value}Form`).classList.remove('d-none');
        });
    });
}

function validateForm(paymentMethod) {
    const form = document.getElementById(`${paymentMethod}PaymentForm`);
    if (!form) return false;

    const inputs = form.querySelectorAll('input, textarea');
    let isValid = true;

    inputs.forEach(input => {
        if (input.required && !input.value) {
            isValid = false;
            input.classList.add('is-invalid');
        } else if (input.pattern && !new RegExp(input.pattern).test(input.value)) {
            isValid = false;
            input.classList.add('is-invalid');
        } else {
            input.classList.remove('is-invalid');
        }
    });

    return isValid;
}

function processPayment() {
    const selectedMethod = document.querySelector('input[name="paymentMethod"]:checked');
    
    if (!selectedMethod) {
        alert("Please select a payment method");
        return;
    }

    if (!validateForm(selectedMethod.value)) {
        alert("Please fill all required fields correctly");
        return;
    }

    // Generate order ID
    const orderId = 'ORD' + Date.now();

    // Show success message
    alert(`Order placed successfully!\nOrder ID: ${orderId}\nThank you for shopping with us!`);
    
    // Clear cart and redirect to home
    localStorage.removeItem("cart");
    window.location.href = "/";
}


</script>